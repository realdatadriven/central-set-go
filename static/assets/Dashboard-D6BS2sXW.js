const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./EditDashboardItem-BEA4olvJ.js","./index-B3J7V0-m.js","./index-uB0_zdoO.css","./pt-Du24fFAZ.js","./ObjectEditor-sSDLqVTL.js"])))=>i.map(i=>d[i]);
import{S as gt,i as wt,s as kt,G as Je,I as Ne,a as F,t as pe,b as Y,c as oe,d as w,H as Oe,f as je,g as ae,h as b,m as ce,k as G,n as Ee,o as N,p as ve,q as z,r as De,u as me,v as fe,x as Le,y as tt,z as pt,A as vt,C as Dt,D as nt,j as Te,e as Ve,F as dt,w as bt,T as qt,J as St,M as Mt,K as Ft,L as Nt,N as Et,l as y,Y as Ot,a6 as jt,a1 as zt,O as Bt,V as At,Q as Jt,a2 as Tt,a3 as st,W as qe,a9 as rt}from"./index-B3J7V0-m.js";import"./pt-Du24fFAZ.js";import Vt from"./DataViz-Z-3FkKk-.js";function lt(s,n,t){const r=s.slice();return r[51]=n[t],r[52]=n,r[53]=t,r}function it(s,n,t){const r=s.slice();return r[54]=n[t],r}function ot(s){let n,t,r,l,f;return{c(){var m,k;n=F("div"),t=F("input"),w(t,"type","text"),w(t,"class","input input-bordered input-sm flex-grow"),w(n,"class","w-3/12 pl-4"),w(n,"title",r=Oe((k=(m=s[1])==null?void 0:m.dashboard_conf)==null?void 0:k.label,30)),je(n,"display",s[3]?null:"none")},m(m,k){ae(m,n,k),b(n,t),Te(t,s[1].dashboard_conf.label),l||(f=[G(t,"input",s[24]),G(n,"dblclick",s[25])],l=!0)},p(m,k){var o,_;k[0]&130&&t.value!==m[1].dashboard_conf.label&&Te(t,m[1].dashboard_conf.label),k[0]&130&&r!==(r=Oe((_=(o=m[1])==null?void 0:o.dashboard_conf)==null?void 0:_.label,30))&&w(n,"title",r),k[0]&8&&je(n,"display",m[3]?null:"none")},d(m){m&&me(n),l=!1,Le(f)}}}function ct(s){var m,k;let n,t,r=Ve(((k=(m=s[1])==null?void 0:m.dashboard_conf)==null?void 0:k.items)||[]),l=[];for(let o=0;o<r.length;o+=1)l[o]=_t(lt(s,r,o));const f=o=>z(l[o],1,1,()=>{l[o]=null});return{c(){for(let o=0;o<l.length;o+=1)l[o].c();n=dt()},m(o,_){for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(o,_);ae(o,n,_),t=!0},p(o,_){var a,h;if(_[0]&30854){r=Ve(((h=(a=o[1])==null?void 0:a.dashboard_conf)==null?void 0:h.items)||[]);let i;for(i=0;i<r.length;i+=1){const p=lt(o,r,i);l[i]?(l[i].p(p,_),N(l[i],1)):(l[i]=_t(p),l[i].c(),N(l[i],1),l[i].m(n.parentNode,n))}for(ve(),i=r.length;i<l.length;i+=1)f(i);De()}},i(o){if(!t){for(let _=0;_<r.length;_+=1)N(l[_]);t=!0}},o(o){l=l.filter(Boolean);for(let _=0;_<l.length;_+=1)z(l[_]);t=!1},d(o){o&&me(n),bt(l,o)}}}function ft(s){let n,t,r,l;const f=[It,Ht,Ct,Lt],m=[];function k(o,_){var a,h,i,p,q,O,V,g;return(a=o[51])!=null&&a.loading?0:((p=(i=o[7])==null?void 0:i[(h=o[51])==null?void 0:h._id])==null?void 0:p.success)===!1?1:((q=o[51])==null?void 0:q.component)==="Filter"?2:(g=(V=o[7])==null?void 0:V[(O=o[51])==null?void 0:O._id])!=null&&g.data?3:-1}return~(n=k(s))&&(t=m[n]=f[n](s)),{c(){t&&t.c(),r=dt()},m(o,_){~n&&m[n].m(o,_),ae(o,r,_),l=!0},p(o,_){let a=n;n=k(o),n===a?~n&&m[n].p(o,_):(t&&(ve(),z(m[a],1,1,()=>{m[a]=null}),De()),~n?(t=m[n],t?t.p(o,_):(t=m[n]=f[n](o),t.c()),N(t,1),t.m(r.parentNode,r)):t=null)},i(o){l||(N(t),l=!0)},o(o){z(t),l=!1},d(o){o&&me(r),~n&&m[n].d(o)}}}function Lt(s){var r,l,f,m,k;let n,t;return n=new Vt({props:{_id:(r=s[51])==null?void 0:r._id,component:(l=s[51])==null?void 0:l.component,options:y.cloneDeep(s[51]),data:((k=(m=s[7])==null?void 0:m[(f=s[51])==null?void 0:f._id])==null?void 0:k.data)||[]}}),{c(){oe(n.$$.fragment)},m(o,_){ce(n,o,_),t=!0},p(o,_){var h,i,p,q,O;const a={};_[0]&2&&(a._id=(h=o[51])==null?void 0:h._id),_[0]&2&&(a.component=(i=o[51])==null?void 0:i.component),_[0]&2&&(a.options=y.cloneDeep(o[51])),_[0]&130&&(a.data=((O=(q=o[7])==null?void 0:q[(p=o[51])==null?void 0:p._id])==null?void 0:O.data)||[]),n.$set(a)},i(o){t||(N(n.$$.fragment,o),t=!0)},o(o){z(n.$$.fragment,o),t=!1},d(o){fe(n,o)}}}function Ct(s){var k,o,_;let n,t,r,l=Ve(((_=(o=s[7])==null?void 0:o[(k=s[51])==null?void 0:k._id])==null?void 0:_.data)||[]),f=[];for(let a=0;a<l.length;a+=1)f[a]=ut(it(s,l,a));function m(){s[33].call(n,s[51])}return{c(){var a,h;n=F("select");for(let i=0;i<f.length;i+=1)f[i].c();w(n,"class","select select-sm -select-bordered w-full m-0"),s[2][(h=(a=s[51])==null?void 0:a.options)==null?void 0:h.name]===void 0&&Tt(m)},m(a,h){var i,p;ae(a,n,h);for(let q=0;q<f.length;q+=1)f[q]&&f[q].m(n,null);st(n,s[2][(p=(i=s[51])==null?void 0:i.options)==null?void 0:p.name],!0),t||(r=[G(n,"change",m),G(n,"change",Pt)],t=!0)},p(a,h){var i,p,q,O,V;if(s=a,h[0]&130){l=Ve(((q=(p=s[7])==null?void 0:p[(i=s[51])==null?void 0:i._id])==null?void 0:q.data)||[]);let g;for(g=0;g<l.length;g+=1){const u=it(s,l,g);f[g]?f[g].p(u,h):(f[g]=ut(u),f[g].c(),f[g].m(n,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=l.length}h[0]&134&&st(n,s[2][(V=(O=s[51])==null?void 0:O.options)==null?void 0:V.name])},i:qe,o:qe,d(a){a&&me(n),bt(f,a),t=!1,Le(r)}}}function Ht(s){var o,_,a;let n,t,r,l,f,m=((a=(_=s[7])==null?void 0:_[(o=s[51])==null?void 0:o._id])==null?void 0:a.msg)+"",k;return{c(){n=F("div"),t=rt("svg"),r=rt("path"),l=Y(),f=F("span"),k=pe(m),w(r,"stroke-linecap","round"),w(r,"stroke-linejoin","round"),w(r,"stroke-width","2"),w(r,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),w(t,"xmlns","http://www.w3.org/2000/svg"),w(t,"class","stroke-current shrink-0 h-6 w-6"),w(t,"fill","none"),w(t,"viewBox","0 0 24 24"),w(n,"class","alert alert-error")},m(h,i){ae(h,n,i),b(n,t),b(t,r),b(n,l),b(n,f),b(f,k)},p(h,i){var p,q,O;i[0]&130&&m!==(m=((O=(q=h[7])==null?void 0:q[(p=h[51])==null?void 0:p._id])==null?void 0:O.msg)+"")&&Ee(k,m)},i:qe,o:qe,d(h){h&&me(n)}}}function It(s){let n;return{c(){n=F("span"),w(n,"class","loading loading-spinner loading-xs")},m(t,r){ae(t,n,r)},p:qe,i:qe,o:qe,d(t){t&&me(n)}}}function ut(s){var m,k,o;let n,t=((o=s[54])==null?void 0:o[(k=(m=s[51])==null?void 0:m.options)==null?void 0:k.value_field])+"",r,l,f;return{c(){var _,a,h;n=F("option"),r=pe(t),l=Y(),n.__value=f=(h=s[54])==null?void 0:h[(a=(_=s[51])==null?void 0:_.options)==null?void 0:a.label_field],Te(n,n.__value)},m(_,a){ae(_,n,a),b(n,r),b(n,l)},p(_,a){var h,i,p,q,O,V;a[0]&130&&t!==(t=((p=_[54])==null?void 0:p[(i=(h=_[51])==null?void 0:h.options)==null?void 0:i.value_field])+"")&&Ee(r,t),a[0]&130&&f!==(f=(V=_[54])==null?void 0:V[(O=(q=_[51])==null?void 0:q.options)==null?void 0:O.label_field])&&(n.__value=f,Te(n,n.__value))},d(_){_&&me(n)}}}function _t(s){var B,A,J;let n,t,r,l,f=(["MiniStat"].includes((B=s[51])==null?void 0:B.component)?"":Je((A=s[51])==null?void 0:A.label))+"",m,k,o,_,a,h,i,p,q,O,V,g,u,Q,C,U,ee,X,Z=!["Blank"].includes((J=s[51])==null?void 0:J.component),ue,x,W,H,_e,$;i=new Ne({props:{type:"outline",icon:"pencil",path:"icons"}});function Se(){return s[30](s[53],s[51])}V=new Ne({props:{type:"outline",icon:"trash",path:"icons"}});function he(){return s[31](s[53],s[51])}C=new Ne({props:{type:"outline",icon:"document-duplicate",path:"icons"}});function te(){return s[32](s[53],s[51])}let D=Z&&ft(s);function be(...E){return s[34](s[53],s[51],...E)}function Me(...E){return s[35](s[53],s[51],...E)}function K(...E){return s[36](s[53],s[51],...E)}function T(...E){return s[37](s[53],s[51],...E)}return{c(){var E,I,ne,se,re,v,j,le;n=F("div"),t=F("div"),r=F("div"),l=F("span"),m=pe(f),o=Y(),_=F("div"),a=F("button"),h=F("span"),oe(i.$$.fragment),p=Y(),q=F("button"),O=F("span"),oe(V.$$.fragment),g=Y(),u=F("button"),Q=F("span"),oe(C.$$.fragment),ee=Y(),X=F("div"),D&&D.c(),x=Y(),w(l,"class","flex-grow pl-2"),w(l,"title",k=Oe((E=s[51])==null?void 0:E.label)),w(h,"class","w-4 h-4"),w(a,"class","btn btn-square btn-ghost btn-sm"),w(O,"class","w-4 h-4"),w(q,"class","btn btn-square btn-ghost btn-sm"),w(Q,"class","w-4 h-4"),w(u,"class","btn btn-square btn-ghost btn-sm"),w(_,"class","w-auto flex flex-row justify-end flex-wrap overflow-x-hidden overflow-y-hidden"),w(r,"class",U="card-title flex flex-row "+(["Filter"].includes((I=s[51])==null?void 0:I.component)?" !mb-0 ":"")+" "+(["MiniStat"].includes((ne=s[51])==null?void 0:ne.component)?" z-[1] !-mb-6 ":" text-xs border-b-2 border-b-slate-50 ")),w(X,"class",ue="card-body items-center text-center "+(["Filter","MiniStat","Blank_"].includes((se=s[51])==null?void 0:se.component)?"!p-0":"")),w(t,"class","card card-bordered shadow-xs rounded-md w-full card-compact"),je(t,"minHeight",((re=s[51])==null?void 0:re.height)||"250px"),w(n,"class",W=(((v=s[51])==null?void 0:v.width)===12?`w-[${((((j=s[51])==null?void 0:j.width)||12)/12*100).toFixed(0)}%]`:`w-${((le=s[51])==null?void 0:le.width)||11}/12`)+" flex-none p-0.5 ---m-auto --border --border-red-500"),w(n,"draggable",!0)},m(E,I){ae(E,n,I),b(n,t),b(t,r),b(r,l),b(l,m),b(r,o),b(r,_),b(_,a),b(a,h),ce(i,h,null),b(_,p),b(_,q),b(q,O),ce(V,O,null),b(_,g),b(_,u),b(u,Q),ce(C,Q,null),b(t,ee),b(t,X),D&&D.m(X,null),b(n,x),H=!0,_e||($=[G(a,"click",Se),G(q,"click",he),G(u,"click",te),G(n,"dragstart",be),G(n,"dragover",Me),G(n,"drop",K),G(n,"dragend",T)],_e=!0)},p(E,I){var ne,se,re,v,j,le,ge,we,ke,e,c;s=E,(!H||I[0]&2)&&f!==(f=(["MiniStat"].includes((ne=s[51])==null?void 0:ne.component)?"":Je((se=s[51])==null?void 0:se.label))+"")&&Ee(m,f),(!H||I[0]&130&&k!==(k=Oe((re=s[51])==null?void 0:re.label)))&&w(l,"title",k),(!H||I[0]&130&&U!==(U="card-title flex flex-row "+(["Filter"].includes((v=s[51])==null?void 0:v.component)?" !mb-0 ":"")+" "+(["MiniStat"].includes((j=s[51])==null?void 0:j.component)?" z-[1] !-mb-6 ":" text-xs border-b-2 border-b-slate-50 ")))&&w(r,"class",U),I[0]&2&&(Z=!["Blank"].includes((le=s[51])==null?void 0:le.component)),Z?D?(D.p(s,I),I[0]&2&&N(D,1)):(D=ft(s),D.c(),N(D,1),D.m(X,null)):D&&(ve(),z(D,1,1,()=>{D=null}),De()),(!H||I[0]&130&&ue!==(ue="card-body items-center text-center "+(["Filter","MiniStat","Blank_"].includes((ge=s[51])==null?void 0:ge.component)?"!p-0":"")))&&w(X,"class",ue),I[0]&2&&je(t,"minHeight",((we=s[51])==null?void 0:we.height)||"250px"),(!H||I[0]&130&&W!==(W=(((ke=s[51])==null?void 0:ke.width)===12?`w-[${((((e=s[51])==null?void 0:e.width)||12)/12*100).toFixed(0)}%]`:`w-${((c=s[51])==null?void 0:c.width)||11}/12`)+" flex-none p-0.5 ---m-auto --border --border-red-500"))&&w(n,"class",W)},i(E){H||(N(i.$$.fragment,E),N(V.$$.fragment,E),N(C.$$.fragment,E),N(D),H=!0)},o(E){z(i.$$.fragment,E),z(V.$$.fragment,E),z(C.$$.fragment,E),z(D),H=!1},d(E){E&&me(n),fe(i),fe(V),fe(C),D&&D.d(),_e=!1,Le($)}}}function at(s){let n,t;return n=new qt({props:{open:s[4].open,type:s[4].type,msg:s[4].msg,timer:2e4}}),n.$on("dismiss",s[38]),{c(){oe(n.$$.fragment)},m(r,l){ce(n,r,l),t=!0},p(r,l){const f={};l[0]&16&&(f.open=r[4].open),l[0]&16&&(f.type=r[4].type),l[0]&16&&(f.msg=r[4].msg),n.$set(f)},i(r){t||(N(n.$$.fragment,r),t=!0)},o(r){z(n.$$.fragment,r),t=!1},d(r){fe(n,r)}}}function mt(s){let n,t;const r=[s[5]];let l={};for(let f=0;f<r.length;f+=1)l=St(l,r[f]);return n=new Mt({props:l}),n.$on("dismiss",s[39]),{c(){oe(n.$$.fragment)},m(f,m){ce(n,f,m),t=!0},p(f,m){const k=m[0]&32?Ft(r,[Nt(f[5])]):{};n.$set(k)},i(f){t||(N(n.$$.fragment,f),t=!0)},o(f){z(n.$$.fragment,f),t=!1},d(f){fe(n,f)}}}function ht(s){let n,t;return n=new Et({props:{open:s[6]}}),{c(){oe(n.$$.fragment)},m(r,l){ce(n,r,l),t=!0},p(r,l){const f={};l[0]&64&&(f.open=r[6]),n.$set(f)},i(r){t||(N(n.$$.fragment,r),t=!0)},o(r){z(n.$$.fragment,r),t=!1},d(r){fe(n,r)}}}function Kt(s){var E,I,ne,se,re;let n,t,r,l,f=Je((I=(E=s[1])==null?void 0:E.dashboard_conf)==null?void 0:I.label,30)+"",m,k,o,_,a,h=s[8].t("crud.filter")+"",i,p,q=JSON.stringify(s[2])+"",O,V,g,u,Q,C,U,ee,X,Z,ue,x,W,H,_e,$,Se,he,te,D,be,Me,K=((ne=s[1])==null?void 0:ne.dashboard_conf)&&ot(s);C=new Ne({props:{type:"outline",icon:"save",path:"icons"}}),Z=new Ne({props:{type:"outline",icon:"refresh",path:"icons"}}),H=new Ne({props:{type:"outline",icon:"trash",path:"icons"}});let T=((re=(se=s[1])==null?void 0:se.dashboard_conf)==null?void 0:re.items)&&ct(s),B=s[4].open&&at(s),A=s[5].open&&mt(s),J=s[6]&&ht(s);return{c(){var v,j;n=F("div"),t=F("div"),r=F("div"),l=F("span"),m=pe(f),o=Y(),K&&K.c(),_=Y(),a=F("div"),i=pe(h),p=pe("s: "),O=pe(q),V=Y(),g=F("div"),u=F("button"),Q=F("span"),oe(C.$$.fragment),U=Y(),ee=F("button"),X=F("span"),oe(Z.$$.fragment),ue=Y(),x=F("button"),W=F("span"),oe(H.$$.fragment),_e=Y(),$=F("div"),T&&T.c(),Se=Y(),B&&B.c(),he=Y(),A&&A.c(),te=Y(),J&&J.c(),w(l,"class","text-md font-bold text-primary"),w(r,"class","w-3/12 pl-4"),w(r,"title",k=Oe((j=(v=s[1])==null?void 0:v.dashboard_conf)==null?void 0:j.label,30)),je(r,"display",s[3]?"none":null),w(a,"class","flex-grow flex flex-row overflow-x-auto overflow-y-hidden"),w(Q,"class","w-5 h-5"),w(u,"class","btn btn-square btn-ghost btn-sm"),w(X,"class","w-5 h-5"),w(ee,"class","btn btn-square btn-ghost btn-sm"),w(W,"class","w-5 h-5"),w(x,"class","btn btn-square btn-ghost btn-sm"),w(g,"class","w-auto flex flex-row justify-end flex-wrap overflow-x-hidden overflow-y-hidden"),w(t,"class","--navbar --navbar-xs w-full border-b-2 rounded-md border-slate-200 p-0 flex flex-row m-0.5 h-8"),w($,"class","w-full flex flex-row justify-start flex-wrap overflow-x-hidden overflow-y-auto"),w(n,"class","w-full p-2")},m(v,j){ae(v,n,j),b(n,t),b(t,r),b(r,l),b(l,m),b(t,o),K&&K.m(t,null),b(t,_),b(t,a),b(a,i),b(a,p),b(a,O),b(t,V),b(t,g),b(g,u),b(u,Q),ce(C,Q,null),b(g,U),b(g,ee),b(ee,X),ce(Z,X,null),b(g,ue),b(g,x),b(x,W),ce(H,W,null),b(n,_e),b(n,$),T&&T.m($,null),b(n,Se),B&&B.m(n,null),b(n,he),A&&A.m(n,null),b(n,te),J&&J.m(n,null),D=!0,be||(Me=[G(r,"dblclick",s[23]),G(u,"click",s[26]),G(ee,"click",s[27]),G(x,"click",s[28]),G(t,"drop",s[29])],be=!0)},p(v,j){var le,ge,we,ke,e,c,S;(!D||j[0]&2)&&f!==(f=Je((ge=(le=v[1])==null?void 0:le.dashboard_conf)==null?void 0:ge.label,30)+"")&&Ee(m,f),(!D||j[0]&130&&k!==(k=Oe((ke=(we=v[1])==null?void 0:we.dashboard_conf)==null?void 0:ke.label,30)))&&w(r,"title",k),j[0]&8&&je(r,"display",v[3]?"none":null),(e=v[1])!=null&&e.dashboard_conf?K?K.p(v,j):(K=ot(v),K.c(),K.m(t,_)):K&&(K.d(1),K=null),(!D||j[0]&256)&&h!==(h=v[8].t("crud.filter")+"")&&Ee(i,h),(!D||j[0]&4)&&q!==(q=JSON.stringify(v[2])+"")&&Ee(O,q),(S=(c=v[1])==null?void 0:c.dashboard_conf)!=null&&S.items?T?(T.p(v,j),j[0]&2&&N(T,1)):(T=ct(v),T.c(),N(T,1),T.m($,null)):T&&(ve(),z(T,1,1,()=>{T=null}),De()),v[4].open?B?(B.p(v,j),j[0]&16&&N(B,1)):(B=at(v),B.c(),N(B,1),B.m(n,he)):B&&(ve(),z(B,1,1,()=>{B=null}),De()),v[5].open?A?(A.p(v,j),j[0]&32&&N(A,1)):(A=mt(v),A.c(),N(A,1),A.m(n,te)):A&&(ve(),z(A,1,1,()=>{A=null}),De()),v[6]?J?(J.p(v,j),j[0]&64&&N(J,1)):(J=ht(v),J.c(),N(J,1),J.m(n,null)):J&&(ve(),z(J,1,1,()=>{J=null}),De())},i(v){D||(N(C.$$.fragment,v),N(Z.$$.fragment,v),N(H.$$.fragment,v),N(T),N(B),N(A),N(J),D=!0)},o(v){z(C.$$.fragment,v),z(Z.$$.fragment,v),z(H.$$.fragment,v),z(T),z(B),z(A),z(J),D=!1},d(v){v&&me(n),K&&K.d(),fe(C),fe(Z),fe(H),T&&T.d(),B&&B.d(),A&&A.d(),J&&J.d(),be=!1,Le(Me)}}}const Pt=s=>{};function Rt(s,n,t){let r,l;tt(s,pt,e=>t(41,r=e)),tt(s,vt,e=>t(8,l=e));let{_id:f}=n,{table:m}=n,{data:k={}}=n,{aux_data:o={}}=n,{main_table:_=null}=n,{actions:a={}}=n,{action:h={}}=n,i={},p={},q=!1,O={label:"Not named dashboard",refresh_each_ms:1e4,filters:{},items:[{label:"item 1",width:4,height:"240px",component:"EChartsEngine",options:{type:""},raw_sql:!1,query:null,sql:null}]};const V=`key_${Math.floor(Math.random()*Date.now())}`;let g={open:!1,msg:null,type:null},u={open:!1,width:12,heigth:85,header:!0,title:"Dialog Title",header_actions:[],component:null},Q=!1;const C=async e=>{var L;const c=y.cloneDeep(e.data||i);(L=c==null?void 0:c.dashboard_conf)!=null&&L.items&&(c.dashboard_conf.filters={},c.dashboard_conf.items=c.dashboard_conf.items.map(P=>({...P,_id:null})),c.dashboard_conf=JSON.stringify(c.dashboard_conf)),console.log({_data:c}),t(6,Q=!0);const S={lang:r==null?void 0:r.lang,conf:r==null?void 0:r.conf,token:r==null?void 0:r.token,app:r==null?void 0:r.selected_app,table:e.table||m,data:c},M=await Ot(S);if(M.success===!0){t(4,g.open=!0,g),t(4,g.type="success",g),t(4,g.msg=M.msg,g),M.inserted_primary_key&&t(1,i[r.tables[e.table].pk]=M.inserted_primary_key,i);try{h!=null&&h.action&&(h==null||h.action(i))}catch(P){console.log(P.message)}}else t(4,g.open=!0,g),t(4,g.type="error",g),t(4,g.msg=M.msg,g),M!=null&&M.errors&&M.errors.length>0&&(t(5,u.html_msg='<div class="alert alert-error shadow-lg m-1">'+M.errors.map(P=>P).join('</div><div class="alert alert-error shadow-lg m-1">')+"</div>",u),t(5,u.open=!0,u),t(5,u.header=!0,u),t(5,u.title=M.msg,u),t(5,u.actions=[{type:"btn",name:"OK",class:"text-primary--",label:l.t("crud.ok"),action:U}],u),t(5,u.width=4,u),t(5,u.heigth=null,u));t(6,Q=!1)},U=e=>{t(5,u.open=!1,u)},ee=async e=>{var S,M,L,P;const c={lang:r==null?void 0:r.lang,conf:r==null?void 0:r.conf,token:r==null?void 0:r.token,app:r==null?void 0:r.selected_app,table:e==null?void 0:e.table,limit:(e==null?void 0:e.limit)||-1,distinct:(e==null?void 0:e.distinct)||!1,database:(e==null?void 0:e.database)||null,fields:((M=(S=e==null?void 0:e.fields)==null?void 0:S.split(";"))==null?void 0:M.length)>1?(L=e==null?void 0:e.fields)==null?void 0:L.split(";"):((P=e==null?void 0:e.fields)==null?void 0:P.split(","))||null};return await Bt(c)},X=async e=>{var L,P,ie,de;let c={},S=null;try{c=JSON.parse((L=e==null?void 0:e.query)==null?void 0:L.manage_query_conf),S=(c==null?void 0:c.selected_tab)==="query_preview"?c==null?void 0:c.selected_tab_2_prev:c==null?void 0:c.selected_tab}catch{throw new Error(l.t("crud.no_query_setup"))}const M={class:"crud",method:"query",conf:r==null?void 0:r.conf,token:r==null?void 0:r.token,app:r==null?void 0:r.selected_app,data:{build_query:(ie=(P=c==null?void 0:c.tabs)==null?void 0:P[S])==null?void 0:ie.fields,filters:(e==null?void 0:e.filters)||p,query:e==null?void 0:e.sql,use_query_string:(e==null?void 0:e.raw_sql)||!1,database:(e==null?void 0:e.database)||((de=e==null?void 0:e.query)==null?void 0:de.database),limit:-1,offset:0}};return await At(M)},Z=e=>{console.log("_save_edited_item:",e),t(1,i.dashboard_conf.items[e==null?void 0:e.index]=y.cloneDeep(e==null?void 0:e.item),i),t(1,i={...i})},ue=async e=>{var S;t(6,Q=!0);const c=(await Jt(async()=>{const{default:M}=await import("./EditDashboardItem-BEA4olvJ.js");return{default:M}},__vite__mapDeps([0,1,2,3,4]),import.meta.url)).default;if(t(6,Q=!1),e!=null&&e.show_in_popup)t(5,u.actions=null,u),t(5,u.component=c,u),t(5,u.msg=null,u),t(5,u.html_msg=null,u),t(5,u.header_actions=[{type:"icon",icon:"save",name:"SAVE",label:l.t("crud.save"),action:Z}],u),t(5,u.title=`${l.t("crud.edit")} ${l.t("crud.item")}`,u),t(5,u.data={item:y.cloneDeep(e==null?void 0:e._item),index:e==null?void 0:e.i},u),t(5,u.width=80,u),t(5,u.heigth=99,u),t(5,u.open=!0,u);else{const M=`${l.t("crud.edit")} ${l.t("crud.item")} - ${(S=e==null?void 0:e._item)==null?void 0:S.label} `;a.show_in_tabs({component:c,label:M,header_actions:[{type:"icon",icon:"save",name:"SAVE",label:l.t("crud.save"),action:Z}],show_top_close:!0,data:{label:M,table:e.table||m,item:y.cloneDeep(e==null?void 0:e._item),index:e==null?void 0:e.i,mode:"tab"}})}},x=e=>{switch(e==null?void 0:e.action){case"delete":i.dashboard_conf.items.splice(e==null?void 0:e.i,1),t(1,i={...i});break;case"duplicate":try{i.dashboard_conf.items.splice((e==null?void 0:e.i)+1,0,y.cloneDeep({...e==null?void 0:e._item,_id:null}))}catch{i.dashboard_conf.items.push(y.cloneDeep({...e==null?void 0:e._item,_id:null}))}t(1,i={...i});break;case"edit":ue(e);break}},W={},H=(e,c)=>{e.dataTransfer.setData("index",c==null?void 0:c.i),W.index=c==null?void 0:c.i},_e=(e,c)=>{W.index_dest=c==null?void 0:c.i},$=(e,c)=>{var S,M;try{e.preventDefault();const L=W.index,P=y.cloneDeep((M=(S=i==null?void 0:i.dashboard_conf)==null?void 0:S.items)==null?void 0:M[L]),ie=W.index_dest;i.dashboard_conf.items.splice(L,1),i.dashboard_conf.items.splice(ie,0,y.cloneDeep(P)),t(1,i={...i})}catch(L){t(4,g.open=!0,g),t(4,g.type="error",g),t(4,g.msg=L.message,g)}},Se=e=>{var c,S,M;if(e.data){const L={table:((c=e==null?void 0:e.data)==null?void 0:c.table)||m,permanently:(S=e==null?void 0:e.data)==null?void 0:S.permanently,data:(M=e==null?void 0:e.data)==null?void 0:M.data.map(P=>{var de,Fe,ze,Be;const ie=(ze=(Fe=r==null?void 0:r.tables)==null?void 0:Fe[((de=e==null?void 0:e.data)==null?void 0:de.table)||m])==null?void 0:ze.pk;return{[ie]:P[ie],excluded:!0,_to_delete:!0,permanently:(Be=e==null?void 0:e.data)==null?void 0:Be.permanently}})};L.permanently,C(L)}U()},he=e=>{var S,M;const c=l.t("crud.del_alert",{len:(S=e==null?void 0:e.data)==null?void 0:S.length,s:((M=e==null?void 0:e.data)==null?void 0:M.length)>1?"s":""});t(5,u.component=null,u),t(5,u.msg=null,u),t(5,u.html_msg=`<span class="m-2 text-lg">${c}</span>`,u),t(5,u.open=!0,u),t(5,u.header=!1,u),t(5,u.data=e,u),t(5,u.actions=[{type:"btn",icon:"ban",name:"NO",class:"btn-sm text-error",label:l.t("crud.no"),action:U},{type:"btn",icon:"check",name:"YES",class:"btn-sm text-success",label:l.t("crud.yes"),action:Se}],u),t(5,u.width=4,u),t(5,u.heigth=null,u)},te=async e=>{if(e=e||k,!e)t(1,i={dashboard_conf:y.cloneDeep(O)});else if(!e.dashboard_conf)t(1,i={...e,dashboard_conf:y.cloneDeep(O)});else if(typeof e.dashboard_conf=="string"){t(2,p={}),t(7,D={});try{t(1,i={...e,dashboard_conf:JSON.parse(e.dashboard_conf)})}catch{t(1,i={...e,dashboard_conf:y.cloneDeep(O)})}}be(i)};let D={};const be=async e=>{var c,S,M,L,P,ie,de,Fe,ze,Be,He,Ie,Ke,Pe,Re,Ye,Ge,Qe,We,Ue,Xe,Ze,xe,$e,ye;try{for(let R=0;R<(((S=(c=e==null?void 0:e.dashboard_conf)==null?void 0:c.items)==null?void 0:S.length)||0);R++){const d=(L=(M=e==null?void 0:e.dashboard_conf)==null?void 0:M.items)==null?void 0:L[R];if((d==null?void 0:d.component)!=="Blank"){(d==null?void 0:d.component)==="Filter"&&(p?Array.isArray(p)&&t(2,p={}):t(2,p={}),p[(P=d==null?void 0:d.options)==null?void 0:P.name]||t(2,p[(ie=d==null?void 0:d.options)==null?void 0:ie.name]=null,p)),e.dashboard_conf.items[R]._id||(e.dashboard_conf.items[R]._id=jt(`item-${d==null?void 0:d.label.replace(" ","_")}`),t(1,i={...i})),e.dashboard_conf.items[R].loading=!0;try{if(((de=d==null?void 0:d.options)==null?void 0:de.type)==="Read"?t(7,D[e.dashboard_conf.items[R]._id]=await ee(d==null?void 0:d.options),D):t(7,D[e.dashboard_conf.items[R]._id]=await X(d),D),(d==null?void 0:d.component)==="Filter"&&!p[(Fe=d==null?void 0:d.options)==null?void 0:Fe.name]){const Ae=(Be=(ze=D[e.dashboard_conf.items[R]._id])==null?void 0:ze.data)==null?void 0:Be.length;t(2,p[(He=d==null?void 0:d.options)==null?void 0:He.name]=(Re=(Ke=(Ie=D[e.dashboard_conf.items[R]._id])==null?void 0:Ie.data)==null?void 0:Ke[0])==null?void 0:Re[(Pe=d==null?void 0:d.options)==null?void 0:Pe.value_field],p),((Ye=d==null?void 0:d.options)==null?void 0:Ye.default)==="last"?t(2,p[(Ge=d==null?void 0:d.options)==null?void 0:Ge.name]=(Xe=(We=(Qe=D[e.dashboard_conf.items[R]._id])==null?void 0:Qe.data)==null?void 0:We[Ae-1])==null?void 0:Xe[(Ue=d==null?void 0:d.options)==null?void 0:Ue.value_field],p):((Ze=d==null?void 0:d.options)==null?void 0:Ze.default)==="---all"&&t(2,p[(xe=d==null?void 0:d.options)==null?void 0:xe.name]=(ye=($e=D[e.dashboard_conf.items[R]._id])==null?void 0:$e.data)==null?void 0:ye.map(Ce=>{var et;return Ce==null?void 0:Ce[(et=d==null?void 0:d.options)==null?void 0:et.value_field]}),p)}}catch(Ae){t(7,D[e.dashboard_conf.items[R]._id]={success:!1,msg:Ae==null?void 0:Ae.message},D)}delete e.dashboard_conf.items[R].loading}}}catch(R){console.log(R.message)}};Dt(async()=>{l.changeLanguage(r==null?void 0:r.lang),console.log({table:m,data:k,main_table:_,aux_data:o});try{nt.locale(r==null?void 0:r.lang)}catch{nt.locale("en-us")}te(k)});const Me=()=>{t(3,q=!q)};function K(){i.dashboard_conf.label=this.value,t(1,i),t(7,D)}const T=()=>{t(3,q=!q)},B=()=>{var e;return C({data:{...i,dashboard:(e=k==null?void 0:k.dashboard_conf)==null?void 0:e.label},table:"dashboard"})},A=()=>te(i),J=()=>{he({data:[i],table:"dashboard"})},E=e=>$(e),I=(e,c)=>x({i:e,_item:c,action:"edit"}),ne=(e,c)=>x({i:e,_item:c,action:"delete"}),se=(e,c)=>x({i:e,_item:c,action:"duplicate"});function re(e){var c;p[(c=e==null?void 0:e.options)==null?void 0:c.name]=zt(this),t(2,p),t(7,D),t(1,i)}const v=(e,c,S)=>H(S,{i:e,_item:c}),j=(e,c,S)=>_e(S,{i:e,_item:c}),le=(e,c,S)=>$(S),ge=(e,c,S)=>$(S),we=e=>{t(4,g.open=!1,g)},ke=e=>U(e.detail);return s.$$set=e=>{"_id"in e&&t(17,f=e._id),"table"in e&&t(18,m=e.table),"data"in e&&t(0,k=e.data),"aux_data"in e&&t(19,o=e.aux_data),"main_table"in e&&t(20,_=e.main_table),"actions"in e&&t(21,a=e.actions),"action"in e&&t(22,h=e.action)},s.$$.update=()=>{s.$$.dirty[0]&4456448&&((h==null?void 0:h.name)==="form_customization"||(h==null?void 0:h.name)==="save"&&(console.log(V,h),C({table:m}))),s.$$.dirty[0]&131072&&(console.log({_id:f}),te())},[k,i,p,q,g,u,Q,D,l,C,U,x,H,_e,$,he,te,f,m,o,_,a,h,Me,K,T,B,A,J,E,I,ne,se,re,v,j,le,ge,we,ke]}class Wt extends gt{constructor(n){super(),wt(this,n,Rt,Kt,kt,{_id:17,table:18,data:0,aux_data:19,main_table:20,actions:21,action:22},null,[-1,-1])}}export{Wt as default};
