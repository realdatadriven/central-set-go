var Gt=Object.defineProperty;var mt=r=>{throw TypeError(r)};var zt=(r,e,t)=>e in r?Gt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var T=(r,e,t)=>zt(r,typeof e!="symbol"?e+"":e,t),gt=(r,e,t)=>e.has(r)||mt("Cannot "+t);var o=(r,e,t)=>(gt(r,e,"read from private field"),t?t.call(r):e.get(r)),d=(r,e,t)=>e.has(r)?mt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),g=(r,e,t,n)=>(gt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var pt=(r,e,t,n)=>({set _(i){g(r,e,i,t)},get _(){return o(r,e,n)}});import{S as jt,i as qt,s as Ft,F as Oe,g as j,W as Z,u as q,a as Q,b as ut,f as H,d as we,at as yt,h as Ae,t as at,n as ft,J as et,c as Vt,m as Qt,K as Ht,L as Yt,o as $t,q as Kt,v as Jt,af as wt}from"./index-B3J7V0-m.js";import{t as Ot,a as Xt,l as Zt,g as bt,f as We}from"./formatting-B68yg4v9.js";import{s as en,i as tn,E as nn,T as rn}from"./EvidenceDash-BcoqogQS.js";function sn(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function*on(r,e){if(e===void 0)for(let t of r)t!=null&&(t=+t)>=t&&(yield t);else{let t=-1;for(let n of r)(n=e(n,++t,r))!=null&&(n=+n)>=n&&(yield n)}}class cn{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const s=t[i],c=e+s,l=Math.abs(e)<Math.abs(s)?e-(c-s):s-(c-e);l&&(t[n++]=l),e=c}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t=this._n,n,i,s,c=0;if(t>0){for(c=e[--t];t>0&&(n=c,i=e[--t],c=n+i,s=i-(c-n),!s););t>0&&(s<0&&e[t-1]<0||s>0&&e[t-1]>0)&&(i=s*2,n=c+i,i==n-c&&(c=n))}return c}}function kt(r,e){const t=new cn;if(e===void 0)for(let n of r)(n=+n)&&t.add(n);else{let n=-1;for(let i of r)(i=+e(i,++n,r))&&t.add(i)}return+t}function tt(r,e){let t;if(e===void 0)for(const n of r)n!=null&&(t<n||t===void 0&&n>=n)&&(t=n);else{let n=-1;for(let i of r)(i=e(i,++n,r))!=null&&(t<i||t===void 0&&i>=i)&&(t=i)}return t}function nt(r,e){let t;if(e===void 0)for(const n of r)n!=null&&(t>n||t===void 0&&n>=n)&&(t=n);else{let n=-1;for(let i of r)(i=e(i,++n,r))!=null&&(t>i||t===void 0&&i>=i)&&(t=i)}return t}function Ut(r,e,t=0,n=r.length-1,i=sn){for(;n>t;){if(n-t>600){const u=n-t+1,a=e-t+1,h=Math.log(u),E=.5*Math.exp(2*h/3),_=.5*Math.sqrt(h*E*(u-E)/u)*(a-u/2<0?-1:1),b=Math.max(t,Math.floor(e-a*E/u+_)),y=Math.min(n,Math.floor(e+(u-a)*E/u+_));Ut(r,e,b,y,i)}const s=r[e];let c=t,l=n;for(Te(r,t,e),i(r[n],s)>0&&Te(r,t,n);c<l;){for(Te(r,c,l),++c,--l;i(r[c],s)<0;)++c;for(;i(r[l],s)>0;)--l}i(r[t],s)===0?Te(r,t,l):(++l,Te(r,l,n)),l<=e&&(t=l+1),e<=l&&(n=l-1)}return r}function Te(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}function ln(r,e,t){if(r=Float64Array.from(on(r,t)),!!(n=r.length)){if((e=+e)<=0||n<2)return nt(r);if(e>=1)return tt(r);var n,i=(n-1)*e,s=Math.floor(i),c=tt(Ut(r,s).subarray(0,s+1)),l=nt(r.subarray(s+1));return c+(l-c)*(i-s)}}function un(r,e){return ln(r,.5,e)}function it(r,e){return n=>{e=e??{};const i={},s=Object.keys(r);for(const c of s)i[c]=r[c](n);if(e.rest&&n.length){const c=Object.keys(n[0]);for(const l of c)s.includes(l)||(i[l]=e.rest(l)(n))}return[i]}}function an(r,e,t,n){if(!r.length)return[];const i={};let s;if(n==null)s=Object.keys(r[0]);else{s=[];for(const c of en(n))typeof c=="function"?s.push(...c(r)):s.push(c)}for(const c of s)i[c]=e(c)(r);return[i]}function ri(r,e){return n=>an(n,e,void 0,r)}function Et(r){if(r!=null&&r.predicate){const e=r.predicate;return t=>t.reduce((n,i,s)=>e(i,s,t)?n+1:n,0)}return e=>e.length}function fn(r,e){let t=typeof r=="function"?r:n=>n[r];if(e!=null&&e.predicate){const n=t,i=e.predicate;t=(s,c,l)=>i(s,c,l)?n(s,c,l):0}return n=>kt(n,t)}function hn(r,e){let t=0;for(let n=0;n<r.length;++n){const i=e(r[n],n,r);+i===i&&(t+=1)}return t?kt(r,e)/t:void 0}function Pt(r){const e=typeof r=="function"?r:t=>t[r];return t=>nt(t,e)}function Bt(r){const e=typeof r=="function"?r:t=>t[r];return t=>tt(t,e)}function dn(r){const e=typeof r=="function"?r:t=>t[r];return t=>hn(t,e)}function mn(r){const e=typeof r=="function"?r:t=>t[r];return t=>un(t,e)}function St(r,e={}){const t=typeof r=="function"?r:n=>n[r];return n=>{const i=new Map;let s=0,c=0;for(const l of n){const u=t(l,c++,n);if(!i.has(u)){if(!e.includeUndefined&&u===void 0||e.includeNull===!1&&u===null)continue;s+=1,i.set(u,!0)}}return s}}function Tt(r,e,t=!0){const n=Ot(r,it(t?{count:Et(e),countDistinct:St(e),min:Pt(e),max:Bt(e),median:mn(e),mean:dn(e),sum:fn(e)}:{count:Et(e),countDistinct:St(e)}))[0],{maxDecimals:i,unitType:s}=gn(r.map(c=>c[e]));return{min:n.min,max:n.max,median:n.median,mean:n.mean,count:n.count,countDistinct:n.countDistinct,sum:n.sum,maxDecimals:i,unitType:s}}function si(r,e){const t=Ot(r,it({min:Pt(e),max:Bt(e)}))[0];return[t.min,t.max]}function gn(r){var e;if(r==null||r.length===0)return{maxDecimals:0,unitType:"unknown"};{let t=0;for(const n of r){const i=(e=n==null?void 0:n.toString().split(".")[1])==null?void 0:e.length;i>t&&(t=i)}return{maxDecimals:t,unitType:"number"}}}function pn(r,e){let t=Xt(r,e),n=["id","gdp"],i=["of","the","and","in","on"];function s(c){return c.replace(/\S*/g,function(l){return!n.includes(l)&&!i.includes(l)?l.charAt(0).toUpperCase()+l.substr(1).toLowerCase():n.includes(l)?l.toUpperCase():l.toLowerCase()})}return t=s(t.replace(/_/g," ")),t}function yn(r,e="object"){const t={},n=tn(r);for(const i of Object.keys(r[0])){const s=n.find(a=>{var h;return((h=a.name)==null?void 0:h.toLowerCase())===(i==null?void 0:i.toLowerCase())})??{name:i,evidenceType:nn.NUMBER,typeFidelity:rn.INFERRED},c=s.evidenceType;let l=s.evidenceType==="number"?Tt(r,i,!0):Tt(r,i,!1);s.evidenceType!=="number"&&(l.maxDecimals=0,l.unitType=s.evidenceType);const u=Zt(i,s,l);t[i]={title:pn(i,u),type:c,evidenceColumnType:s,format:u,columnUnitSummary:l}}return e!=="object"?Object.entries(t).map(([i,s])=>({id:i,...s})):t}const wn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let bn=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r));for(;r--;)e+=wn[t[r]&63];return e};const En={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_BASE_PATH:"./"};var Nt={};const Pe=()=>{if(typeof process<"u")return!!(Nt.EVIDENCE_DEBUG||Nt.VITE_PUBLIC_EVIDENCE_DEBUG);if(typeof En<"u")return!1};class ve{constructor(e,t){e&&(this.table=String(e)),t&&(this.column=t)}get columns(){return this.column?[this.column]:[]}toString(){const{table:e,column:t}=this;if(t){const n=t.startsWith("*")?t:`"${t}"`;return`${e?`${At(e)}.`:""}${n}`}else return e?At(e):"NULL"}}function At(r){return r.split(".").map(t=>`"${t}"`).join(".")}function Sn(r,e){return r instanceof ve&&r.column===e}function ee(r){return typeof r=="string"?Nn(r):r}function Je(r){return typeof r=="string"?Tn(r):r}function Tn(r){return new ve(r)}function Nn(r,e=null){return arguments.length===1&&(e=r,r=null),new ve(r,e)}function ht(r){switch(typeof r){case"boolean":return r?"TRUE":"FALSE";case"string":return`'${r.replace("'","''")}'`;case"number":return Number.isFinite(r)?String(r):"NULL";default:if(r==null)return"NULL";if(r instanceof Date){const e=+r;if(Number.isNaN(e))return"NULL";const t=r.getUTCFullYear(),n=r.getUTCMonth(),i=r.getUTCDate();return e===Date.UTC(t,n,i)?`MAKE_DATE(${t}, ${n+1}, ${i})`:`EPOCH_MS(${e})`}else return r instanceof RegExp?`'${r.source}'`:String(r)}}const Ie=r=>typeof(r==null?void 0:r.addEventListener)=="function";function xt(r){return r instanceof Ke}class Ke{constructor(e,t,n){this._expr=Array.isArray(e)?e:[e],this._deps=t||[],this.annotate(n);const i=this._expr.filter(s=>Ie(s));i.length>0?(this._params=Array.from(new Set(i)),this._params.forEach(s=>{s.addEventListener("value",()=>{var c;return An(this,(c=this.map)==null?void 0:c.get("value"))})})):this.addEventListener=void 0}get value(){return this}get columns(){const{_params:e,_deps:t}=this;if(e){const n=new Set(e.flatMap(i=>{var c;const s=(c=i.value)==null?void 0:c.columns;return Array.isArray(s)?s:[]}));if(n.size){const i=new Set(t);return n.forEach(s=>i.add(s)),Array.from(i)}}return t}get column(){return this._deps.length?this._deps[0]:this.columns[0]}annotate(...e){return Object.assign(this,...e)}toString(){return this._expr.map(e=>Ie(e)&&!xt(e)?ht(e.value):e).join("")}addEventListener(e,t){const n=this.map||(this.map=new Map);(n.get(e)||(n.set(e,new Set),n.get(e))).add(t)}}function An(r,e){if(e!=null&&e.size)return Promise.allSettled(Array.from(e,t=>t(r)))}function Wt(r,e){const t=[r[0]],n=new Set,i=e.length;for(let s=0,c=0;s<i;){const l=e[s];Ie(l)?t[++c]=l:(Array.isArray(l==null?void 0:l.columns)&&l.columns.forEach(a=>n.add(a)),t[c]+=typeof l=="string"?l:ht(l));const u=r[++s];Ie(t[c])?t[++c]=u:t[c]+=u}return{spans:t,cols:Array.from(n)}}function R(r,...e){const{spans:t,cols:n}=Wt(r,e);return new Ke(t,n)}function rt(r,e){return Array.from({length:r},()=>e)}class ie extends Ke{constructor(e,t,n,i,s="",c="",l=""){let u;if(i&&!(s||c||l))u=i?R`${t} OVER "${i}"`:R`${t} OVER ()`;else{const _=s&&c?" ":"",b=(s||c)&&l?" ":"";u=R`${t} OVER (${i?`"${i}" `:""}${s}${_}${c}${b}${l})`}n&&(u=R`(${u})::${n}`);const{_expr:h,_deps:E}=u;super(h,E),this.window=e,this.func=t,this.type=n,this.name=i,this.group=s,this.order=c,this.frame=l}get basis(){return this.column}get label(){const{func:e}=this;return e.label??e.toString()}over(e){const{window:t,func:n,type:i,group:s,order:c,frame:l}=this;return new ie(t,n,i,e,s,c,l)}partitionby(...e){const t=e.flat().filter(h=>h).map(ee),n=R(["PARTITION BY ",rt(t.length-1,", "),""],...t),{window:i,func:s,type:c,name:l,order:u,frame:a}=this;return new ie(i,s,c,l,n,u,a)}orderby(...e){const t=e.flat().filter(h=>h).map(ee),n=R(["ORDER BY ",rt(t.length-1,", "),""],...t),{window:i,func:s,type:c,name:l,group:u,frame:a}=this;return new ie(i,s,c,l,u,n,a)}rows(e){const t=vt("ROWS",e),{window:n,func:i,type:s,name:c,group:l,order:u}=this;return new ie(n,i,s,c,l,u,t)}range(e){const t=vt("RANGE",e),{window:n,func:i,type:s,name:c,group:l,order:u}=this;return new ie(n,i,s,c,l,u,t)}}function vt(r,e){if(Ie(e)){const t=R`${e}`;return t.toString=()=>`${r} ${It(e.value)}`,t}return`${r} ${It(e)}`}function It(r){const[e,t]=r,n=e===0?"CURRENT ROW":Number.isFinite(e)?`${Math.abs(e)} PRECEDING`:"UNBOUNDED PRECEDING",i=t===0?"CURRENT ROW":Number.isFinite(t)?`${Math.abs(t)} FOLLOWING`:"UNBOUNDED FOLLOWING";return`BETWEEN ${n} AND ${i}`}class Ne extends Ke{constructor(e,t,n,i,s){t=(t||[]).map(ee);const{strings:c,exprs:l}=vn(e,t,n,i,s),{spans:u,cols:a}=Wt(c,l);super(u,a),this.aggregate=e,this.args=t,this.type=n,this.isDistinct=i,this.filter=s}get basis(){return this.column}get label(){const{aggregate:e,args:t,isDistinct:n}=this,i=n?"DISTINCT"+(t.length?" ":""):"",s=t.length?`(${i}${t.map(In).join(", ")})`:"";return`${e.toLowerCase()}${s}`}distinct(){const{aggregate:e,args:t,type:n,filter:i}=this;return new Ne(e,t,n,!0,i)}where(e){const{aggregate:t,args:n,type:i,isDistinct:s}=this;return new Ne(t,n,i,s,e)}window(){const{aggregate:e,args:t,type:n,isDistinct:i}=this,s=new Ne(e,t,null,i);return new ie(e,s,n)}partitionby(...e){return this.window().partitionby(...e)}orderby(...e){return this.window().orderby(...e)}rows(e){return this.window().rows(e)}range(e){return this.window().range(e)}}function vn(r,e,t,n,i){const s=`)${t?`::${t}`:""}`;let c=[`${r}(${n?"DISTINCT ":""}`],l=[];return e.length?(c=c.concat([...rt(e.length-1,", "),`${s}${i?" FILTER (WHERE ":""}`,...i?[")"]:[]]),l=[...e,...i?[i]:[]]):c[0]+="*"+s,{exprs:l,strings:c}}function In(r){const e=ht(r);return e&&e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function be(r,e){return(...t)=>new Ne(r,t,e)}const Rn=be("COUNT","INTEGER"),_n=be("AVG"),Cn=be("MAX"),Mn=be("MIN"),Dn=be("SUM","DOUBLE"),Ln=be("MEDIAN");let xe=class ae{static select(...e){return new ae().select(...e)}static from(...e){return new ae().from(...e)}static with(...e){return new ae().with(...e)}static union(...e){return new re("UNION",e.flat())}static unionAll(...e){return new re("UNION ALL",e.flat())}static intersect(...e){return new re("INTERSECT",e.flat())}static except(...e){return new re("EXCEPT",e.flat())}static describe(e){const t=e.clone(),{clone:n,toString:i}=t;return Object.assign(t,{describe:!0,clone:()=>ae.describe(n.call(t)),toString:()=>`DESCRIBE ${i.call(t)}`})}constructor(){this.query={with:[],select:[],from:[],where:[],groupby:[],having:[],window:[],qualify:[],orderby:[]},this.cteFor=null}clone(){const e=new ae;return e.query={...this.query},e}with(...e){const{query:t}=this;if(e.length===0)return t.with;{const n=[],i=(s,c)=>{const l=c.clone();l.cteFor=this,n.push({as:s,query:l})};return e.flat().forEach(s=>{if(s!=null)if(s.as&&s.query)i(s.as,s.query);else for(const c in s)i(c,s[c])}),t.with=t.with.concat(n),this}}select(...e){const{query:t}=this;if(e.length===0)return t.select;{const n=[];for(const s of e.flat())if(s!=null)if(typeof s=="string")n.push({as:s,expr:ee(s)});else if(s instanceof ve)n.push({as:s.column,expr:s});else if(Array.isArray(s))n.push({as:s[0],expr:s[1]});else for(const c in s)n.push({as:Be(c),expr:ee(s[c])});const i=new Set(n.map(s=>s.as));return t.select=t.select.filter(s=>!i.has(s.as)).concat(n.filter(s=>s.expr)),this}}$select(...e){return this.query.select=[],this.select(...e)}distinct(e=!0){return this.query.distinct=!!e,this}from(...e){const{query:t}=this;if(e.length===0)return t.from;{const n=[];return e.flat().forEach(i=>{if(i!=null)if(typeof i=="string")n.push({as:i,from:Je(i)});else if(i instanceof ve)n.push({as:i.table,from:i});else if(Xe(i)||xt(i))n.push({from:i});else if(Array.isArray(i))n.push({as:Be(i[0]),from:Je(i[1])});else for(const s in i)n.push({as:Be(s),from:Je(i[s])})}),t.from=t.from.concat(n),this}}$from(...e){return this.query.from=[],this.from(...e)}sample(e,t){const{query:n}=this;if(arguments.length===0)return n.sample;{let i=e;return typeof e=="number"&&(i=e>0&&e<1?{perc:100*e,method:t}:{rows:Math.round(e),method:t}),n.sample=i,this}}where(...e){const{query:t}=this;return e.length===0?t.where:(t.where=t.where.concat(e.flat().filter(n=>n)),this)}$where(...e){return this.query.where=[],this.where(...e)}groupby(...e){const{query:t}=this;return e.length===0?t.groupby:(t.groupby=t.groupby.concat(e.flat().filter(n=>n).map(ee)),this)}$groupby(...e){return this.query.groupby=[],this.groupby(...e)}having(...e){const{query:t}=this;return e.length===0?t.having:(t.having=t.having.concat(e.flat().filter(n=>n)),this)}window(...e){const{query:t}=this;if(e.length===0)return t.window;{const n=[];return e.flat().forEach(i=>{if(i!=null)for(const s in i)n.push({as:Be(s),expr:i[s]})}),t.window=t.window.concat(n),this}}qualify(...e){const{query:t}=this;return e.length===0?t.qualify:(t.qualify=t.qualify.concat(e.flat().filter(n=>n)),this)}orderby(...e){const{query:t}=this;return e.length===0?t.orderby:(t.orderby=t.orderby.concat(e.flat().filter(n=>n).map(ee)),this)}limit(e){const{query:t}=this;return arguments.length===0?t.limit:(t.limit=Number.isFinite(e)?e:void 0,this)}offset(e){const{query:t}=this;return arguments.length===0?t.offset:(t.offset=Number.isFinite(e)?e:void 0,this)}get subqueries(){const{query:e,cteFor:t}=this,n=((t==null?void 0:t.query)||e).with,i=n==null?void 0:n.reduce((c,{as:l,query:u})=>(c[l]=u,c),{}),s=[];return e.from.forEach(({from:c})=>{if(Xe(c))s.push(c);else if(i[c.table]){const l=i[c.table];s.push(l)}}),s}toString(){const{with:e,select:t,distinct:n,from:i,sample:s,where:c,groupby:l,having:u,window:a,qualify:h,orderby:E,limit:_,offset:b}=this.query,y=[];if(e.length){const p=e.map(({as:w,query:I})=>`"${w}" AS (${I})`);y.push(`WITH ${p.join(", ")}`)}const O=t.map(({as:p,expr:w})=>Sn(w,p)&&!w.table?`${w}`:`${w} AS "${p}"`);if(y.push(`SELECT${n?" DISTINCT":""} ${O.join(", ")}`),i.length){const p=i.map(({as:w,from:I})=>{const k=Xe(I)?`(${I})`:`${I}`;return!w||w===I.table?k:`${k} AS "${w}"`});y.push(`FROM ${p.join(", ")}`)}if(c.length){const p=c.map(String).filter(w=>w).join(" AND ");p&&y.push(`WHERE ${p}`)}if(s){const{rows:p,perc:w,method:I,seed:k}=s,B=p?`${p} ROWS`:`${w} PERCENT`,Ee=I?` (${I}${k!=null?`, ${k}`:""})`:"";y.push(`USING SAMPLE ${B}${Ee}`)}if(l.length&&y.push(`GROUP BY ${l.join(", ")}`),u.length){const p=u.map(String).filter(w=>w).join(" AND ");p&&y.push(`HAVING ${p}`)}if(a.length){const p=a.map(({as:w,expr:I})=>`"${w}" AS (${I})`);y.push(`WINDOW ${p.join(", ")}`)}if(h.length){const p=h.map(String).filter(w=>w).join(" AND ");p&&y.push(`QUALIFY ${p}`)}return E.length&&y.push(`ORDER BY ${E.join(", ")}`),Number.isFinite(_)&&y.push(`LIMIT ${_}`),Number.isFinite(b)&&y.push(`OFFSET ${b}`),y.join(" ")}};class re{constructor(e,t){this.op=e,this.queries=t.map(n=>n.clone()),this.query={orderby:[]},this.cteFor=null}clone(){const e=new re(this.op,this.queries);return e.query={...this.query},e}orderby(...e){const{query:t}=this;return e.length===0?t.orderby:(t.orderby=t.orderby.concat(e.flat().filter(n=>n).map(ee)),this)}limit(e){const{query:t}=this;return arguments.length===0?t.limit:(t.limit=Number.isFinite(e)?e:void 0,this)}offset(e){const{query:t}=this;return arguments.length===0?t.offset:(t.offset=Number.isFinite(e)?e:void 0,this)}get subqueries(){const{queries:e,cteFor:t}=this;return t&&e.forEach(n=>n.cteFor=t),e}toString(){const{op:e,queries:t,query:{orderby:n,limit:i,offset:s}}=this,c=[t.join(` ${e} `)];return n.length&&c.push(`ORDER BY ${n.join(", ")}`),Number.isFinite(i)&&c.push(`LIMIT ${i}`),Number.isFinite(s)&&c.push(`OFFSET ${s}`),c.join(" ")}}function Xe(r){return r instanceof xe||r instanceof re}function Be(r){return jn(r)?r.slice(1,-1):r}function jn(r){return r[0]==='"'&&r[r.length-1]==='"'}const Ze=r=>{let e=null,t=null;const n=new Promise((c,l)=>{e=c,t=l});let i="init",s=null;if(!e||!t)throw new Error;return{promise:n,resolve:c=>{if(e)(i==="loading"||i==="init")&&(i="resolved",s=c,e(c),r==null||r());else throw new Error("SharedPromise encountered an error: res not defined")},reject:c=>{if(t)(i==="loading"||i==="init")&&(i="rejected",n.catch(()=>{}),t(c),r==null||r());else throw new Error("SharedPromise encountered an error: rej not defined")},get state(){return i},get value(){return s},start(){i="loading",r==null||r()}}},W=(r,e,t)=>{try{const n=typeof e=="function"?e():e;return n instanceof Promise?n.then(i=>r(i,!0)).catch(i=>{const s=i instanceof Error?i:new Error("Unknown Error",{cause:i});if(t)return t(s,!0);throw s}):r(n,!1)}catch(n){const i=n instanceof Error?n:new Error("Unknown Error",{cause:n});if(t)return t(i,!1);throw i}},Rt=(r,e)=>{const t=e.reduce((n,i)=>n+On(i.column_type),e.length*4);return Math.abs(t*r)};function qn(r){return r.startsWith("STRUCT")||r.endsWith("[]")}function Fn(r){return r.startsWith("DECIMAL")}function On(r){const e={string:30,number:12,boolean:4,date:48};if(qn(r))return console.warn(`[!] Evidence does not support DuckDB Struct or Array
If you need to use one, convert it to JSON in your query, and then manually parse it in your project`),e.string;if(Fn(r))return e.number;switch(r){case"BOOLEAN":return e.boolean;case"BIGINT":case"DOUBLE":case"FLOAT":case"INTEGER":case"SMALLINT":case"TINYINT":case"UBIGINT":case"UINTEGER":case"USMALLINT":case"UTINYINT":case"HUGEINT":return e.number;case"UUID":case"VARCHAR":return e.string;case"DATE":case"TIMESTAMP":case"TIMESTAMP_S":case"TIMESTAMP_MS":case"TIMESTAMP_NS":case"TIMESTAMP WITH TIME ZONE":return e.date;case"INTERVAL":case"TIME":case"TIME WITH TIME ZONE":case"BLOB":case"BIT":return e.string;default:return console.error(`Column type ${r} is not supported`),e.string}}const kn=/--([^']|'.*')+$/,Un=/(\/\*.*\*\/)/g,Pn=r=>{const e=r.split(`
`);let t=!1;for(let n=e.length;n>0;n--){let i=e[n-1],s="";const c=Array.from(i.matchAll(Un));for(const u of c){const a=i.slice(0,u.index),h=i.slice(u.index+u[0].length);i=`${a}${h}`}if(t&&i.includes("/*")){t=!1;const u=i.split("/*");i=u.slice(0,-1).join("/*"),s+="/*"+u.slice(-1)}if(i.trim().endsWith("*/")){t=!0;continue}const l=kn.exec(i);if(l){const u=i.slice(0,l.index),a=u.trimEnd();if(a.endsWith(";")){const h=i.slice(l.index),E=u.slice(a.length,u.length);i=`${u.slice(0,-1+-1*(u.length-a.length))}${E}${h}`}}else if(i.trimEnd().endsWith(";")){const a=i.lastIndexOf(";");i=i.slice(0,a)+i.slice(a+1)}for(const u of c){const a=i.slice(0,u.index),h=i.slice(u.index);i=`${a}${u[0]}${h}`}if(i!==e[n-1]){e[n-1]=i+s;break}}return e.push(""),e.join(`
`)};var se,C,Re,K,_e,D,Ce,Me,De,S,Y,ne,L,fe,G,Ge,he,oe,Le,U,ze,N,ce,A,le,v,de,Ve,P,Qe,He,je,ot,ct,z,lt,F,me,ge,x,V,J,$,M,qe,pe,Ye,ye,X,Fe,$e;const f=class f{constructor(e,t,n={}){d(this,S);d(this,se);d(this,C,[]);d(this,Re,-1);d(this,K,0);d(this,_e,-1);d(this,D,[]);d(this,Ce);d(this,Me,-1);d(this,De);d(this,L);d(this,fe);d(this,U,-1);d(this,ze,()=>{this.lengthLoaded&&this.columnsLoaded?(g(this,U,Rt(this.length,this.columns)),o(this,U)>o(f,Le)&&o(this,X).call(this,"highScore",o(this,U))):Promise.allSettled([o(this,A).promise,o(this,v).promise]).then(([e,t])=>{if(e.status==="rejected"||t.status==="rejected"){g(this,U,-1);return}if(!o(this,K)||!o(this,D)){g(this,U,-1);return}g(this,U,Rt(this.length,this.columns)),o(this,U)>o(f,Le)&&o(this,X).call(this,"highScore",o(this,U))}).catch(e=>{console.error(`${this.id} | Failed to calculate Query score ${e}`)})});d(this,N,Ze(()=>this.publish(`data promise (${o(this,N).state})`)));d(this,ce,()=>{var s;if(o(this,N).state!=="init")return o(this,N).promise;if(o(this,S,Y))return o(this,F).call(this,"data error","Refusing to execute data query, store has an error state"),o(this,N).promise;if(o(this,N).state!=="init"||this.opts.noResolve)return o(this,N).promise;o(this,N).start();const e=`
---- Data ${o(this,x)} ${o(this,V)}
${this.text.trim()}
        `.trim()+`
`;o(this,me).call(this,"data query text",`
`+e,"font-family: monospace;");const t=o(this,M);o(s=f,Ge).call(s,this);const n=performance.now();return W((c,l)=>{g(this,C,c);const u=performance.now();return n-u>5e3&&(o(this,X).call(this,"longRun",n-u),o(this,F).call(this,"long-running",`Query took ${n-u}ms to execute`)),g(this,Re,u-n),o(this,le).call(this),o(this,N).resolve(this),o(this,X).call(this,"dataReady",void 0),l?o(this,N).promise:this},()=>t(e,`${o(this,x)}_data`),(c,l)=>(g(this,S,c,ne),o(this,N).reject(c),l?o(this,N).promise:this))});T(this,"fetch",()=>o(this,de).call(this)instanceof Promise&&!this.opts.noResolve?Promise.allSettled([o(this,de).call(this),o(this,ce).call(this)]).then(()=>this.value):(o(this,ce).call(this),this.value));T(this,"backgroundFetch",()=>{if(typeof window>"u"){o(this,F).call(this,"background fetch skip","Did not execute backgroundFetch in SSR");return}o(this,F).call(this,"background fetch","Executed backgroundFetch"),W(()=>{},async()=>(await new Promise(e=>setTimeout(e,0)),o(this,M).call(this,`--data
${this.text.trim()}`,this.id)),()=>{})});d(this,A,Ze(()=>this.publish(`length promise (${o(this,A).state})`)));d(this,le,()=>{if(o(this,C)&&o(this,N).state==="resolved"&&o(this,A).state==="init")return o(this,F).call(this,"length inferred","Inferred length from already-resolved data promise",o(this,C)),g(this,K,o(this,C).length),o(this,A).resolve(this),o(this,A).promise;if(o(this,S,Y))return o(this,F).call(this,"length error","Refusing to execute length query, store has an error state",o(this,S,Y)),o(this,A).reject(o(this,S,Y)),o(this,A).value??o(this,A).promise;if(o(this,A).state!=="init"||this.opts.noResolve)return o(this,A).promise;o(this,A).start();const e=`
---- Length ${o(this,x)} (${o(this,V)})
SELECT COUNT(*) as rowCount FROM (${this.text.trim()})
        `.trim()+`
`,t=o(this,M);o(this,me).call(this,"length query text",`
`+e,"font-family: monospace;");const n=performance.now();return W((s,c)=>{const l=performance.now();return g(this,_e,l-n),g(this,K,s[0].rowCount),o(this,A).resolve(this),c?o(this,A).promise:this},()=>t(e,`${o(this,x)}_length`),(s,c)=>(g(this,S,s,ne),o(this,A).reject(s),c?o(this,A).promise:this))});d(this,v,Ze(()=>this.publish(`columns promise (${o(this,v).state})`)));d(this,de,()=>{if(o(this,S,Y))return o(this,F).call(this,"cols query error","Refusing to execute columns query, store has an error state",o(this,S,Y)),o(this,v).value??o(this,v).promise;if(o(this,v).state!=="init"||this.opts.noResolve)return o(this,v).promise;o(this,v).start();const e=`
---- Columns ${o(this,x)} (${o(this,V)})
DESCRIBE ${this.text.trim()}
        `.trim()+`
`;o(this,me).call(this,"columns query text",`
`+e,"font-family: monospace;");const t=o(this,M),n=performance.now();return W((s,c)=>{const l=performance.now();return g(this,Me,l-n),g(this,D,s),o(this,v).resolve(this),g(this,Ce,Object.fromEntries(s.map(u=>[u.column_name,void 0]))),c?o(this,v).promise:this},()=>t(e,`${o(this,x)}_columns`),(s,c)=>(g(this,S,s,ne),o(this,v).reject(s),c?o(this,v).promise:this))});d(this,Ve,()=>new Proxy([],{getPrototypeOf:()=>Object.getPrototypeOf(o(this,C)),has:(t,n)=>n in o(this,C)||n in this,get:(t,n)=>{let i=n;if(typeof i=="string"&&/^[\d.]+$/.exec(i)&&(i=parseInt(i)),(typeof i=="number"||f.ProxyFetchTriggers.includes(i.toString()))&&o(this,N).state==="init"&&(o(this,F).call(this,"implicit fetch",`Implicit query fetch triggered by ${i.toString()}`),o(this,ce).call(this)),i==="length"&&o(this,le).call(this),i==="constructor")return o(this,C).constructor;if(i==="toString")return o(this,C).toString.bind(o(this,C));const s=i in this?this:o(this,C)&&i in o(this,C)?o(this,C):null;if(s===null)return typeof i!="number"||i>o(this,K)?void 0:o(this,Ce)??{};const c=s[i];return typeof c=="function"?c.bind(s):c}}));d(this,F,Pe()?(e,...t)=>{const n=`${(performance.now()/1e3).toFixed(3)} | ${this.id} (${this.hash}) | ${e}`;console.groupCollapsed(n);for(const i of t)console.debug(typeof i=="function"?i():i);console.groupEnd()}:()=>{});d(this,me,Pe()?(e,t,n)=>{const i=`${(performance.now()/1e3).toFixed(3)} | ${this.id} (${this.hash}) | ${e}`;console.groupCollapsed(i),console.debug(`%c${t}`,n),console.groupEnd()}:()=>{});d(this,x);d(this,V);d(this,J);d(this,M);T(this,"opts");d(this,qe);d(this,pe,new Set);T(this,"subscribe",e=>(o(this,pe).add(e),e(o(this,se)),()=>o(this,pe).delete(e)));d(this,Ye,0);T(this,"publish",e=>{if(pt(this,Ye)._++>1e5)throw new Error("Query published too many times.");o(this,F).call(this,"publish",`Publishing triggered by ${e}`,this),o(this,pe).forEach(t=>t(o(this,se)))});d(this,ye,{dataReady:new Set,error:new Set,highScore:new Set,longRun:new Set});d(this,X,(e,t)=>{o(this,ye)[e].forEach(n=>n(t,e))});T(this,"on",(e,t)=>{o(this,ye)[e].add(t)});T(this,"off",(e,t)=>{o(this,ye)[e].delete(t)});T(this,"addEventListener",this.on);T(this,"removeEventListener",this.off);T(this,"where",e=>f.create(o(this,L).clone().where(R`${e}`),o(this,M),{knownColumns:o(this,D),noResolve:o(this,J).noResolve}));T(this,"withOrdinal",e=>{const t=o(this,L).clone();return t.select({ordinal:R`row_number() over (${e})`}),f.create(t,o(this,M),{...o(this,S,$),knownColumns:o(this,D)})});T(this,"search",(e,t,n)=>{(typeof n>"u"||n<0||n>1)&&(n=1-1/e.length);const i=[...o(this,D),{column_name:"similarity",column_type:"INTEGER",nullable:"NO"}],s=f.create,c=e.replaceAll("'","''"),u=(Array.isArray(t)?t:[t]).map(h=>{const E=R`CASE WHEN lower("${h.trim()}") = lower('${c}') THEN 2 ELSE 0 END`,_=R`jaccard(lower('${c}'), lower("${h}"))`,b=c.length>=1?R`CASE WHEN lower("${h.trim()}") LIKE lower('%${c.split(" ").join("%")}%') THEN 1 ELSE 0 END`:R`0`;return R`GREATEST((${E}), (${_}), (${b}))`}).join(",");return s(o(this,L).clone().$select({similarity:R`GREATEST(${u})`},"*").where(R`"similarity" > ${n} `).orderby(R`"similarity" DESC`),o(this,M),{knownColumns:i,...o(this,S,$)})});T(this,"limit",e=>f.create(o(this,L).clone().limit(e),o(this,M),{knownColumns:o(this,D),...o(this,S,$)}));T(this,"offset",e=>f.create(o(this,L).clone().offset(e),o(this,M),{knownColumns:o(this,D),...o(this,S,$)}));T(this,"paginate",(e,t)=>f.create(o(this,L).clone().offset(e).limit(t),o(this,M),{knownColumns:o(this,D),...o(this,S,$)}));T(this,"groupBy",(e,t)=>{const n=o(this,L).clone();return n.$select(e),t&&n.select({rows:Rn("*")}),n.$groupby(e),f.create(n,o(this,M),{knownColumns:o(this,D),...o(this,S,$)})});T(this,"agg",e=>{var n;const t=o(this,L).clone();for(const[i,s]of Object.entries(e)){if(!o(n=f,$e).call(n,i))throw new Error(`Unknown agg function: ${i}`);const c=o(f,Fe)[i],l=Array.isArray(s)?s:[s];for(const u of l){const a=typeof u=="object"?u.as:`${i}_${u}`,h=typeof u=="object"?u.col:u;t.select({[a]:c(h)})}}return f.create(t,o(this,M),{knownColumns:o(this,D),...o(this,S,$)})});var u;g(this,qe,(u=new Error().stack)==null?void 0:u.split(`
`).slice(2).map(a=>a.slice(7)).join(`
`));const{id:i,initialData:s=void 0,knownColumns:c=void 0,initialError:l=void 0}=n;if(this.opts=n,g(this,M,t),typeof e!="string"&&!(e instanceof xe)&&(console.warn(`Query ${i} has no query text`),n.noResolve=!0),o(f,ge)||console.warn("Directly using new Query() is not a recommended use-case. Please use Query.create()"),g(f,ge,!1),g(this,se,o(this,Ve).call(this)),g(this,fe,(e==null?void 0:e.toString())??"SELECT 'Empty Query' WHERE 0"),g(this,V,te(o(this,fe))),g(this,x,i??o(this,V)),g(this,J,n),e&&typeof e!="string")g(this,L,e);else if(e){const a=new xe().from({[`inputQuery-${bn(2)}`]:R`(${Pn(e)})`}).select("*");g(this,L,a)}else{g(this,L,new xe),g(this,S,new Error("Refusing to create Query: No Query Text provided"),ne);return}if(l){g(this,S,l,ne);return}if(s)o(this,F).call(this,"initial data","Created with initial data",s),W(a=>{g(this,C,a),n.initialDataDirty?(this.publish("dataDirty"),o(this,ce).call(this)):(o(this,N).resolve(this),o(this,le).call(this))},s,a=>{g(this,S,a,ne)});else if(n.noResolve)return o(this,N).start(),o(this,A).start(),o(this,v).start(),this;if(c){if(!Array.isArray(c))throw new Error("Expected knownColumns to be an array",{cause:c});o(this,F).call(this,"known columns","Created with known columns",c),g(this,D,c),o(this,v).resolve(this)}else W(()=>{},o(this,de).call(this),(a,h)=>{if(!h)throw a});W(()=>{},o(this,le).call(this),(a,h)=>{if(!h)throw a}),n.autoScore&&o(this,ze).call(this)}get value(){return o(this,se)}get dataLoaded(){return["resolved","rejected"].includes(o(this,N).state)}get dataLoading(){return o(this,N).state==="loading"}get dataQueryTime(){return o(this,Re)}get length(){return o(this,K)}get lengthLoaded(){return["resolved","rejected"].includes(o(this,A).state)}get lengthLoading(){return o(this,A).state==="loading"}get lengthQueryTime(){return o(this,_e)}get columns(){return o(this,D)}get columnsLoaded(){return["resolved","rejected"].includes(o(this,v).state)}get columnsLoading(){return o(this,v).state==="loading"}get columnsQueryTime(){return o(this,Me)}get ready(){return o(this,A).state==="resolved"&&o(this,v).state==="resolved"&&o(this,N).state==="resolved"}get loading(){return o(this,A).state==="loading"||o(this,v).state==="loading"||o(this,N).state==="loading"}get error(){return o(this,S,Y)}get originalText(){return o(this,fe)}get text(){var e;return((e=o(this,L))==null?void 0:e.toString())??"SELECT 'Empty Query' WHERE 0"}static get queriesInFlight(){return o(f,G).size>0}static resetInFlightQueries(){g(f,G,new Set)}static addEventListener(e,t){o(this,he)[e].add(t)}static removeEventListener(e,t){o(this,he)[e].delete(t)}get score(){return o(this,U)}get isQuery(){return!0}static[Symbol.hasInstance](e){return f.isQuery(e)}static get ProxyFetchTriggers(){return["at"]}static get cacheSize(){return o(this,P).size}get id(){return o(this,x)}get hash(){return o(this,V)}get createdStack(){return o(this,qe)}};se=new WeakMap,C=new WeakMap,Re=new WeakMap,K=new WeakMap,_e=new WeakMap,D=new WeakMap,Ce=new WeakMap,Me=new WeakMap,De=new WeakMap,S=new WeakSet,Y=function(){return o(this,De)},ne=function(e){e&&(console.error(`${this.id} | Error in Query!`,e==null?void 0:e.message),o(this,X).call(this,"error",e),g(this,De,e))},L=new WeakMap,fe=new WeakMap,G=new WeakMap,Ge=new WeakMap,he=new WeakMap,oe=new WeakMap,Le=new WeakMap,U=new WeakMap,ze=new WeakMap,N=new WeakMap,ce=new WeakMap,A=new WeakMap,le=new WeakMap,v=new WeakMap,de=new WeakMap,Ve=new WeakMap,P=new WeakMap,Qe=new WeakMap,He=new WeakMap,je=new WeakMap,ot=new WeakMap,ct=new WeakMap,z=new WeakMap,lt=new WeakMap,F=new WeakMap,me=new WeakMap,ge=new WeakMap,x=new WeakMap,V=new WeakMap,J=new WeakMap,$=function(){return{autoScore:o(this,J).autoScore,noResolve:o(this,J).noResolve,disableCache:o(this,J).disableCache}},M=new WeakMap,qe=new WeakMap,pe=new WeakMap,Ye=new WeakMap,ye=new WeakMap,X=new WeakMap,Fe=new WeakMap,$e=new WeakMap,d(f,G,new Set),d(f,Ge,e=>{var t;o(f,G).size===0&&o(t=f,oe).call(t,"inFlightQueryStart",void 0),o(f,G).add(e),o(e,N).promise.finally(()=>{var n;o(f,G).delete(e),o(f,G).size===0&&o(n=f,oe).call(n,"inFlightQueryEnd",void 0)})}),d(f,he,{inFlightQueryStart:new Set,inFlightQueryEnd:new Set,queryCreated:new Set,cacheCleared:new Set}),d(f,oe,(e,t)=>{o(f,he)[e].forEach(n=>n(t,e))}),d(f,Le,10*1024*1024),T(f,"isQuery",e=>typeof e!="object"||!e?!1:"isQuery"in e&&e.isQuery===!0),T(f,"CacheMaxScore",5*10*1024),d(f,P,new Map),T(f,"emptyCache",()=>{var e;o(f,P).clear(),o(e=f,oe).call(e,"cacheCleared",void 0)}),d(f,Qe,e=>{var t;o(f,P).set(e.hash,{query:e,added:Date.now()}),o(t=f,z).call(t,"cache",`Added to cache: ${e.hash}`,{cacheSize:o(f,P).size,cacheScore:Array.from(o(f,P).values()).reduce((n,i)=>n+i.query.score,0)})}),d(f,He,e=>{const t=o(f,P).get(e);return t?t.query:null}),d(f,je,()=>{let e=Array.from(o(f,P).values()).reduce((n,i)=>n+i.query.score,0);const t=Array.from(o(f,P).values()).sort((n,i)=>n.added-i.added);for(;e>f.CacheMaxScore;){const n=t.shift();if(!n)break;o(f,P).delete(n.query.hash),e-=n.query.score}}),T(f,"createReactive",(e,t,n)=>{const{loadGracePeriod:i=250,callback:s=()=>{},execFn:c}=e,l=f.create;let u=n,a=0,h;const E=(b,y)=>{var k;if(!u)throw new Error;a+=1;const O=a;o(k=f,z).call(k,`${u.id} (${te(b)}) | Reactive Updating`,b,{changeIdx:a,targetChangeIdx:O,hash:te(b)},{initialOpts:t,newOpts:y});const p=f.isQuery(b)?b:l(b,c,Object.assign({},t,{initialData:void 0,initialError:void 0},y)),w=p.fetch();let I=w;w instanceof Promise&&(I=Promise.race([new Promise(B=>setTimeout(B,i)),p.fetch()])),W(()=>{var B;if(a!==O){o(B=f,z).call(B,"changeIdx does not match, results are discarded");return}h==null||h(),u=p.value,h=u.subscribe(s)},I,B=>{throw console.warn(`Error while attempting to update reactive query: ${B.message}`),B})};function _(){t={...t,initialData:void 0,initialError:void 0}}return(b,y)=>{if(u){W(()=>{},E(b,y),p=>{console.warn(`Error while attempting to update reactive query: ${p.message}`)});return}u=l(b,c,Object.assign({},t,y));const O=u.fetch();W(_,O),h=u.subscribe(s),s(u)}}),d(f,ot,!1),d(f,ct,()=>{}),T(f,"create",(e,t,n,i)=>{var u,a,h,E,_,b,y,O;const s=te(e);let c;if(typeof n=="string"?c={...i,id:n}:n?(c=n,c.id||(c.id=s+"-"+Math.random().toString(36).substring(0,4))):c={id:s+"-"+Math.random().toString(36).substring(0,4)},"autoScore"in c||(c.autoScore=!0),c.disableCache)o(_=f,z).call(_,`${c.id??"[query id missing]"} (${s}) | cache disabled`,`Cache is disabled for ${c.id??"[query id missing]"}`,{opts:c,query:e,hash:te(e)});else{const p=o(u=f,He).call(u,s);if(o(a=f,je).call(a),p)return o(h=f,z).call(h,`${c.id??"[query id missing]"} (${s}) | Using cached query`,{opts:c,hash:te(e)},e,p),p.value;o(E=f,z).call(E,`${c.id??"[query id missing]"} (${s}) | Cached query not found`,{opts:c,hash:te(e)},e)}g(f,ge,!0);const l=new f(e,t,c);return o(b=f,oe).call(b,"queryCreated",{raw:l,proxied:l.value}),c.disableCache||(o(y=f,Qe).call(y,l),o(O=f,je).call(O)),l.value}),d(f,z,Pe()?(e,...t)=>{const n=`${(performance.now()/1e3).toFixed(3)} | Query | ${e}`;console.groupCollapsed(n);for(const i of t)console.debug(typeof i=="function"?i():i);console.groupEnd()}:()=>{}),d(f,lt,Pe()?(e,t,n)=>{const i=`${(performance.now()/1e3).toFixed(3)} | Query | ${e}`;console.groupCollapsed(i),console.debug(`%c${t}`,n),console.groupEnd()}:()=>{}),d(f,ge,!1),d(f,Fe,{sum:Dn,avg:_n,min:Mn,max:Cn,median:Ln}),d(f,$e,e=>e in o(f,Fe));let st=f;const te=(...r)=>(t=>{let n=0;for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);n=(n<<5)-n+s,n&=n}return new Uint32Array([n])[0].toString(36)})(JSON.stringify(r));function Bn(r,e,t){var s,c,l,u,a;let n=[];if(r===void 0)throw Error("No data provided");if(typeof r!="object")throw Error("'"+r+"' is not a recognized query result. Data should be provided in the format: data = {"+r.replace("data.","")+"}");if(r[0]===void 0||r.length===0)throw Error("Dataset is empty: query ran successfully, but no data was returned from the database");if(((c=(s=r[0])==null?void 0:s.error_object)==null?void 0:c.error)!=null)throw Error("SQL Error: "+((a=(u=(l=r[0])==null?void 0:l.error_object)==null?void 0:u.error)==null?void 0:a.message));if(e!=null){if(!(e instanceof Array))throw Error("reqCols must be passed in as an array");for(var i=0;i<e.length;i++)if(e[i]==null)throw Error("Missing required columns");if(st.isQuery(r))for(const E of r.columns)n.push(E.column_name);else for(const E of Object.keys(r[0]))n.push(E);let h;for(i=0;i<e.length;i++)if(h=e[i],!n.includes(h))throw Error("'"+h+"' is not a column in the dataset");if(t!=null&&t[0]!=null){for(i=0;i<t.length;i++)if(h=t[i],!n.includes(h))throw Error("'"+h+"' is not a column in the dataset")}}}function xn(r){return{c:Z,m:Z,p:Z,d:Z}}function Wn(r){let e,t,n,i;function s(a,h){return a[6]==="right"?zn:Gn}let c=s(r),l=c(r),u=r[4]&&Lt(r);return{c(){e=Q("span"),t=Q("span"),l.c(),n=ut(),u&&u.c(),H(t,"text-align",r[7]??"right"),we(e,"class",i="m-0 "+r[3]+" font-ui inline-block rounded-md"),yt(e,"px-1",r[0]),H(e,"background-color",r[0]?r[12][r[11]].chipColor:void 0),H(e,"border",r[0]?`1px solid ${r[12][r[11]].chipBorder}`:void 0),H(e,"color",r[12][r[11]].color)},m(a,h){j(a,e,h),Ae(e,t),l.m(t,null),Ae(t,n),u&&u.m(t,null)},p(a,h){c===(c=s(a))&&l?l.p(a,h):(l.d(1),l=c(a),l&&(l.c(),l.m(t,n))),a[4]?u?u.p(a,h):(u=Lt(a),u.c(),u.m(t,null)):u&&(u.d(1),u=null),h&128&&H(t,"text-align",a[7]??"right"),h&8&&i!==(i="m-0 "+a[3]+" font-ui inline-block rounded-md")&&we(e,"class",i),h&9&&yt(e,"px-1",a[0]),h&2049&&H(e,"background-color",a[0]?a[12][a[11]].chipColor:void 0),h&2049&&H(e,"border",a[0]?`1px solid ${a[12][a[11]].chipBorder}`:void 0),h&2048&&H(e,"color",a[12][a[11]].color)},d(a){a&&q(e),l.d(),u&&u.d()}}}function Gn(r){let e,t,n=r[2]&&_t(r),i=r[1]&&Ct(r);return{c(){n&&n.c(),e=ut(),i&&i.c(),t=Oe()},m(s,c){n&&n.m(s,c),j(s,e,c),i&&i.m(s,c),j(s,t,c)},p(s,c){s[2]?n?n.p(s,c):(n=_t(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),s[1]?i?i.p(s,c):(i=Ct(s),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},d(s){s&&(q(e),q(t)),n&&n.d(s),i&&i.d(s)}}}function zn(r){let e,t,n=r[1]&&Mt(r),i=r[2]&&Dt(r);return{c(){n&&n.c(),e=ut(),i&&i.c(),t=Oe()},m(s,c){n&&n.m(s,c),j(s,e,c),i&&i.m(s,c),j(s,t,c)},p(s,c){s[1]?n?n.p(s,c):(n=Mt(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),s[2]?i?i.p(s,c):(i=Dt(s),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},d(s){s&&(q(e),q(t)),n&&n.d(s),i&&i.d(s)}}}function _t(r){let e,t=r[11]==="positive"?"&#9650;":r[11]==="negative"?"&#9660;":"—";return{c(){e=Q("span"),we(e,"class","font-[system-ui]")},m(n,i){j(n,e,i),e.innerHTML=t},p(n,i){i&2048&&t!==(t=n[11]==="positive"?"&#9650;":n[11]==="negative"?"&#9660;":"—")&&(e.innerHTML=t)},d(n){n&&q(e)}}}function Ct(r){let e;function t(s,c){return s[8]===null?Qn:Vn}let n=t(r),i=n(r);return{c(){i.c(),e=Oe()},m(s,c){i.m(s,c),j(s,e,c)},p(s,c){n===(n=t(s))&&i?i.p(s,c):(i.d(1),i=n(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){s&&q(e),i.d(s)}}}function Vn(r){let e,t=We(r[8],r[10],r[5])+"",n;return{c(){e=Q("span"),n=at(t)},m(i,s){j(i,e,s),Ae(e,n)},p(i,s){s&1312&&t!==(t=We(i[8],i[10],i[5])+"")&&ft(n,t)},d(i){i&&q(e)}}}function Qn(r){let e;return{c(){e=Q("span"),e.textContent="-",we(e,"class","font-[system-ui]")},m(t,n){j(t,e,n)},p:Z,d(t){t&&q(e)}}}function Mt(r){let e;function t(s,c){return s[8]===null?Yn:Hn}let n=t(r),i=n(r);return{c(){i.c(),e=Oe()},m(s,c){i.m(s,c),j(s,e,c)},p(s,c){n===(n=t(s))&&i?i.p(s,c):(i.d(1),i=n(s),i&&(i.c(),i.m(e.parentNode,e)))},d(s){s&&q(e),i.d(s)}}}function Hn(r){let e,t=We(r[8],r[10],r[5])+"",n;return{c(){e=Q("span"),n=at(t)},m(i,s){j(i,e,s),Ae(e,n)},p(i,s){s&1312&&t!==(t=We(i[8],i[10],i[5])+"")&&ft(n,t)},d(i){i&&q(e)}}}function Yn(r){let e;return{c(){e=Q("span"),e.textContent="-",we(e,"class","font-[system-ui]")},m(t,n){j(t,e,n)},p:Z,d(t){t&&q(e)}}}function Dt(r){let e,t=r[11]==="positive"?"&#9650;":r[11]==="negative"?"&#9660;":"-&thinsp;";return{c(){e=Q("span"),we(e,"class","font-[system-ui]")},m(n,i){j(n,e,i),e.innerHTML=t},p(n,i){i&2048&&t!==(t=n[11]==="positive"?"&#9650;":n[11]==="negative"?"&#9660;":"-&thinsp;")&&(e.innerHTML=t)},d(n){n&&q(e)}}}function Lt(r){let e,t;return{c(){e=Q("span"),t=at(r[4])},m(n,i){j(n,e,i),Ae(e,t)},p(n,i){i&16&&ft(t,n[4])},d(n){n&&q(e)}}}function $n(r){let e;function t(s,c){return s[9]?xn:Wn}let n=t(r),i=n(r);return{c(){i.c(),e=Oe()},m(s,c){i.m(s,c),j(s,e,c)},p(s,[c]){n===(n=t(s))&&i?i.p(s,c):(i.d(1),i=n(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Z,o:Z,d(s){s&&q(e),i.d(s)}}}function Kn(r,e,t){let{data:n=void 0}=e,{row:i=0}=e,{column:s=void 0}=e,{value:c=void 0}=e,{text:l=void 0}=e,{chip:u=!1}=e,{downIsGood:a=!1}=e,{fmt:h=void 0}=e,{format_object:E=void 0}=e,{columnUnitSummary:_=void 0}=e,{showValue:b=!0}=e,{showSymbol:y=!0}=e,{symbolPosition:O="right"}=e,{align:p="right"}=e,{fontClass:w=u?"text-sm":"text-base"}=e,{neutralMin:I=0}=e,{neutralMax:k=0}=e,B={positive:{color:a?"var(--red-700)":"var(--green-700)",chipColor:a?"var(--red-100)":"var(--green-100)",chipBorder:a?"var(--red-300)":"var(--green-300)"},negative:{color:a?"var(--green-700)":"var(--red-700)",chipColor:a?"var(--green-100)":"var(--red-100)",chipBorder:a?"var(--green-300)":"var(--red-300)"},neutral:{color:"var(--grey-500)",chipColor:"var(--grey-100)",chipBorder:"var(--grey-300)"}},Ee,Se,ue,ke,dt;return r.$$set=m=>{"data"in m&&t(13,n=m.data),"row"in m&&t(16,i=m.row),"column"in m&&t(14,s=m.column),"value"in m&&t(17,c=m.value),"text"in m&&t(4,l=m.text),"chip"in m&&t(0,u=m.chip),"downIsGood"in m&&t(15,a=m.downIsGood),"fmt"in m&&t(18,h=m.fmt),"format_object"in m&&t(19,E=m.format_object),"columnUnitSummary"in m&&t(5,_=m.columnUnitSummary),"showValue"in m&&t(1,b=m.showValue),"showSymbol"in m&&t(2,y=m.showSymbol),"symbolPosition"in m&&t(6,O=m.symbolPosition),"align"in m&&t(7,p=m.align),"fontClass"in m&&t(3,w=m.fontClass),"neutralMin"in m&&t(20,I=m.neutralMin),"neutralMax"in m&&t(21,k=m.neutralMax)},r.$$.update=()=>{var m;if(r.$$.dirty&1&&t(0,u=u==="true"||u===!0),r.$$.dirty&32768&&t(15,a=a==="true"||a===!0),r.$$.dirty&2&&t(1,b=b==="true"||b===!0),r.$$.dirty&4&&t(2,y=y==="true"||y===!0),r.$$.dirty&9&&t(3,w=w||(u?"text-sm":"text-base")),r.$$.dirty&8347904)try{if(t(9,Ee=void 0),n){if(typeof n=="string")throw Error(`Received: data=${n}, expected: data={${n}}`);if(Array.isArray(n)||t(13,n=[n]),isNaN(i))throw Error("row must be a number (row="+i+")");try{Object.keys(n[i])[0]}catch{throw Error("Row "+i+" does not exist in the dataset")}t(14,s=s??Object.keys(n[i])[0]),Bn(n,[s]),t(22,ue=yn(n,"array")),t(8,Se=n[i][s]),t(22,ue=ue.filter(Ue=>Ue.id===s)),h?t(10,ke=bt(h,(m=ue[0].format)==null?void 0:m.valueType)):t(10,ke=ue[0].format)}else if(c!==void 0){if(isNaN(c))throw Error("value must be a number (value="+c+")");t(8,Se=c),t(10,ke=h?bt(h,"number"):E??void 0)}else throw Error("No data or value provided. If you referenced a query result, check that the name is correct.");t(11,dt=Se>k?"positive":Se<I?"negative":"neutral")}catch(Ue){t(9,Ee=Ue.message)}},[u,b,y,w,l,_,O,p,Se,Ee,ke,dt,B,n,s,a,i,c,h,E,I,k,ue]}class Jn extends jt{constructor(e){super(),qt(this,e,Kn,$n,Ft,{data:13,row:16,column:14,value:17,text:4,chip:0,downIsGood:15,fmt:18,format_object:19,columnUnitSummary:5,showValue:1,showSymbol:2,symbolPosition:6,align:7,fontClass:3,neutralMin:20,neutralMax:21})}}function Xn(r){let e,t;const n=[r[1],{data:r[0]}];let i={};for(let s=0;s<n.length;s+=1)i=et(i,n[s]);return e=new Jn({props:i}),{c(){Vt(e.$$.fragment)},m(s,c){Qt(e,s,c),t=!0},p(s,[c]){const l=c&3?Ht(n,[c&2&&Yt(s[1]),c&1&&{data:s[0]}]):{};e.$set(l)},i(s){t||($t(e.$$.fragment,s),t=!0)},o(s){Kt(e.$$.fragment,s),t=!1},d(s){Jt(e,s)}}}function Zn(r,e,t){let n,{data:i=void 0}=e;return r.$$set=s=>{t(2,e=et(et({},e),wt(s))),"data"in s&&t(0,i=s.data)},r.$$.update=()=>{t(1,n=Object.fromEntries(Object.entries(e).filter(([,s])=>s!==void 0)))},e=wt(e),[i,n]}class oi extends jt{constructor(e){super(),qt(this,e,Zn,Xn,Ft,{data:0})}}export{oi as D,fn as a,ri as b,Bn as c,si as d,pn as f,yn as g,St as n,it as s};
